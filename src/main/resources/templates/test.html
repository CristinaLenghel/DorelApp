<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <title>Spring Boot + JPA + Datatables</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
</head>

<body>
    <form class="formular" th:action="@{/test}" method="post" th:object="${counties}" >
        <script type="text/javascript" src="../../js/cityDropdownLoad.js"></script>
        <script type="text/javascript" src="../../js/countyDropdownLoad.js"></script>
        <script type="text/javascript" src="../../js/specialtyDropdownLoad.js"></script>
    <div class="form-group">
        <label for="county">Alege judetul:</label>
        <select required="required" name="county" id="county">
            <option disabled selected="selected" > -- Alege judetul -- </option>
            <!--option th:each="county : ${counties}" th:value="${county.name}"
                    th:text="${county.name}" >
            </option-->
        </select>
    </div>

    <div class="form-group">
        <label for="city">Alege orasul:</label>
        <select name="city" id="city" required="required">
            <option disabled="disabled" selected="selected" > -- Alege orasul--</option>
        </select>
    </div>

    <div class="form-group">
        <label for="specialty">Alege orasul:</label>
        <select name="specialty" id="specialty" required="required">
            <option disabled="disabled" selected="selected" > Alege meseria </option>
        </select>
    </div>

    <div id="output"></div>
    <div id="output2"></div>
    <div id="feedback"></div>

<!--script th:inline="javascript">
    /*<![CDATA[*/
    $(document).ready(function(){
		$("#county").change(onSelectChange);
	});

	function onSelectChange2(){
	    var selected = $("#county option:selected");
		var output = "";
		output = "You selected judetul " + selected.text();
		$("#output").html(output);

        var reqparam="";
        reqparam="{countyname} : "+selected.text();
		$("#output2").html(reqparam);

		$.getJSON("/jsondata/cities", {
                countyname : $("#county option:selected"),
                ajax : 'true'
            }, function(data) {
                var html = '<option value="">--Alege orasul--</option>';
                var len = data.length;
                for ( var i = 0; i < len; i++) {
                    html += '<option value="' + data[i].name + '">'
                            + data[i].name + '</option>';
                }
                html += '</option>';
                $('#city').html(html);
            });
	}

    function onSelectChange1(){
        var selected = $("#county option:selected");
		var output = "";
		output = "You selected judetul " + selected.text();
		$("#output").html(output);

        let dropdown = $('#city');

        dropdown.empty();
        dropdown.append('<option selected="true" disabled>Alege Orasul</option>');
        dropdown.prop('selectedIndex', 0);

        const url = 'https://localhost:8080/jsondata/cities';

        // Populate dropdown with list of provinces
        $.getJSON(url, function (data) {
          $.each(data, function (key, entry) {
            dropdown.append($('<option></option>').attr('value', entry.name).text(entry.name));
          })
        });
    }

	function onSelectChange() {
		var selected = $("#county option:selected");
		var output = "";
		output = "You selected judetul " + selected.text();
		$("#output").html(output);

        var reqparam="";
        reqparam="{countyname} : "+selected.text();
		$("#output2").html(reqparam);

        var data = {}
		data["countyname"] = $("#countyname").val();

		$.ajax({
            type : "POST",
            url : "/jsondata/cities?countyname="+selected.text(),
            contentType: "application/json; charset=utf-8",
            dataType : 'json',
            success : function(data) {
                var html = '';
                var len = data.length;
                html += '<option value="0">Alege Orasul</option>';
                for (var i = 0; i < len; i++) {
                    html += '<option value="' + data[i].name + '">'
                        + data[i].name
                        + '</option>';
                    }
                $('#cities').html(html);
            },
            error: function (e) {
                var json = "<h4>Ajax Response</h4><pre>"
                    + e.responseText + "</pre>";
                $('#feedback').html(json);
            }
        });
	}
	/*]]>*/
</script-->
</form>
</body>
</html>